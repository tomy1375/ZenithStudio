---
import MapPin from '../components/icons/MapPin.astro';
import Mail from '../components/icons/Mail.astro';
import Phone from '../components/icons/Phone.astro';
import Instagram from '../components/icons/Instagram.astro';
import Twitter from '../components/icons/Twitter.astro';
import Linkedin from '../components/icons/Linkedin.astro';
import Github from '../components/icons/Github.astro';

// Aquí deberás colocar tu clave de Web3Forms
const WEB3FORMS_ACCESS_KEY = "b3a20725-c34e-4515-9ff2-db2a247f38e6";
---

<section id="contacto" class="section-padding relative overflow-hidden">
  <!-- Fondo con gradiente y efecto de malla -->
  <div class="absolute inset-0 bg-zinc-900"></div>
  
  <!-- Elementos decorativos de fondo -->
  <div class="absolute top-20 left-10 w-72 h-72 bg-purple-600/8 rounded-full blur-2xl"></div>
  <div class="absolute bottom-20 right-10 w-80 h-80 bg-blue-600/8 rounded-full blur-2xl"></div>
  
  <div class="container relative z-10">
    <div class="text-center mb-16">
      <!-- <span class="inline-block py-1 px-3 rounded-full text-sm font-medium bg-gradient-to-r from-purple-500/90 to-blue-500/90 text-white mb-4">Hablemos</span> -->
      <h2 class="section-title text-white text-4xl md:text-5xl font-bold mb-6">Contacto</h2>
      <p class="text-center text-gray-300 max-w-2xl mx-auto">
        ¿Tenés un proyecto en mente? Contactanos para convertir tus ideas en realidad.
      </p>
    </div>

    <div class="grid md:grid-cols-2 gap-8 lg:gap-12 max-w-5xl mx-auto">
      <!-- Formulario de contacto -->
      <div class="group relative">
        <!-- Borde con gradiente -->
        <div class="absolute -inset-0.5 bg-gradient-to-r from-purple-600/50 to-blue-600/50 rounded-2xl opacity-40 group-hover:opacity-70 blur-[2px] group-hover:blur-[3px] transition-all duration-500"></div>
        
        <div class="relative bg-zinc-900/80 p-8 md:p-10 rounded-xl backdrop-blur-sm h-full">
          <h3 class="text-2xl font-bold mb-6 bg-gradient-to-r from-purple-400 to-blue-400 bg-clip-text text-transparent">Envianos un mensaje</h3>
          
          <form action="https://api.web3forms.com/submit" method="POST" class="space-y-5" id="contact-form">
            <!-- Web3Forms Access Key (requerido) -->
            <input type="hidden" name="access_key" value={WEB3FORMS_ACCESS_KEY} />
            
            <!-- Campo oculto para capturar bots -->
            <input type="checkbox" name="botcheck" class="hidden" style="display: none;" />
            
            <!-- URL de redirección después del envío (opcional) -->
            <input type="hidden" name="redirect" value="" />
            
            <!-- Nombre del asunto del correo (opcional) -->
            <input type="hidden" name="subject" value="Nuevo mensaje desde Zenith Studio" />
            
            <!-- Campo de nombre -->
            <div class="group/field">
              <label for="nombre" class="block text-sm font-medium mb-2 text-gray-300">Nombre</label>
              <div class="relative">
                <input
                  type="text"
                  id="nombre"
                  name="nombre"
                  class="w-full px-4 py-3 bg-zinc-800/50 border border-zinc-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50 transition-all duration-300 group-hover/field:border-zinc-600/70"
                  required
                />
                <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-purple-500/20 to-blue-500/20 opacity-0 group-hover/field:opacity-100 blur-xl transition-opacity duration-300 pointer-events-none"></div>
              </div>
            </div>
            
            <!-- Campo de email -->
            <div class="group/field">
              <label for="email" class="block text-sm font-medium mb-2 text-gray-300">Email</label>
              <div class="relative">
                <input
                  type="email"
                  id="email"
                  name="email"
                  class="w-full px-4 py-3 bg-zinc-800/50 border border-zinc-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50 transition-all duration-300 group-hover/field:border-zinc-600/70"
                  required
                />
                <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-purple-500/20 to-blue-500/20 opacity-0 group-hover/field:opacity-100 blur-xl transition-opacity duration-300 pointer-events-none"></div>
              </div>
            </div>
            
            <!-- Campo de mensaje -->
            <div class="group/field">
              <label for="mensaje" class="block text-sm font-medium mb-2 text-gray-300">Mensaje</label>
              <div class="relative">
                <textarea
                  id="mensaje"
                  name="mensaje"
                  rows="5"
                  class="w-full px-4 py-3 bg-zinc-800/50 border border-zinc-700/50 rounded-lg focus:outline-none focus:ring-2 focus:ring-purple-500/50 transition-all duration-300 resize-none group-hover/field:border-zinc-600/70"
                  required
                ></textarea>
                <div class="absolute inset-0 rounded-lg bg-gradient-to-r from-purple-500/20 to-blue-500/20 opacity-0 group-hover/field:opacity-100 blur-xl transition-opacity duration-300 pointer-events-none"></div>
              </div>
            </div>
            
            <!-- Botón de envío -->
            <div class="relative mt-8 overflow-hidden group/button rounded-full">
              <div class="absolute -inset-0.5 bg-gradient-to-r from-purple-600 to-blue-600 rounded-full opacity-70 group-hover/button:opacity-100 blur-sm transition-all duration-500"></div>
              <button
                type="submit"
                class="relative w-full bg-zinc-900 text-white font-medium py-3 px-6 rounded-full hover:bg-zinc-800 transition-colors duration-300 overflow-hidden group-hover/button:shadow-lg group-hover/button:shadow-purple-500/20"
              >
                <span class="relative z-10">Enviar mensaje</span>
                <span class="absolute inset-0 bg-gradient-to-r from-purple-600/40 to-blue-600/40 transform scale-x-0 group-hover/button:scale-x-100 origin-left transition-transform duration-500 ease-out"></span>
              </button>
            </div>
            
            <!-- Mensaje de estado -->
            <div id="result" class="mt-3 text-center hidden"></div>
          </form>
        </div>
      </div>

      <!-- Información de contacto -->
      <div class="group relative">
        <!-- Borde con gradiente -->
        <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-600/50 to-purple-600/50 rounded-2xl opacity-40 group-hover:opacity-70 blur-[2px] group-hover:blur-[3px] transition-all duration-500"></div>
        
        <div class="relative bg-zinc-900/80 p-8 md:p-10 rounded-xl backdrop-blur-sm h-full">
          <h3 class="text-2xl font-bold mb-8 bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">Información de contacto</h3>
          
          <div class="space-y-8">
            <!-- Ubicación -->
            <div class="flex items-start gap-5 group/item">
              <div class="relative">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500/50 to-purple-500/50 rounded-xl opacity-0 group-hover/item:opacity-100 blur-sm transition-all duration-300"></div>
                <div class="relative bg-zinc-800/80 p-4 rounded-xl text-white">
                  <MapPin class="w-6 h-6" />
                </div>
              </div>
              <div>
                <h4 class="font-semibold text-white text-lg mb-1">Ubicación</h4>
                <p class="text-gray-400">Cordoba, Argentina</p>
              </div>
            </div>

            <!-- Email -->
            <div class="flex items-start gap-5 group/item">
              <div class="relative">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500/50 to-purple-500/50 rounded-xl opacity-0 group-hover/item:opacity-100 blur-sm transition-all duration-300"></div>
                <div class="relative bg-zinc-800/80 p-4 rounded-xl text-white">
                  <Mail class="w-6 h-6" />
                </div>
              </div>
              <div>
                <h4 class="font-semibold text-white text-lg mb-1">Email</h4>
                <p class="text-gray-400">equipo@zenithstudio.site
                </p>
              </div>
            </div>

            <!-- Teléfono -->
            <div class="flex items-start gap-5 group/item">
              <div class="relative">
                <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500/50 to-purple-500/50 rounded-xl opacity-0 group-hover/item:opacity-100 blur-sm transition-all duration-300"></div>
                <div class="relative bg-zinc-800/80 p-4 rounded-xl text-white">
                  <Phone class="w-6 h-6" />
                </div>
              </div>
              <div>
                <h4 class="font-semibold text-white text-lg mb-1">Teléfono</h4>
                <p class="text-gray-400">+54 388 4326541</p>
              </div>
            </div>

            <!-- Redes sociales -->
            <div class="pt-6 border-t border-zinc-800/50">
              <h4 class="font-semibold text-white text-lg mb-5">Seguinos en redes</h4>
              <div class="flex gap-4">
                <a href="#" class="group/social relative">
                  <div class="absolute -inset-0.5 bg-gradient-to-r from-pink-500/70 to-purple-500/70 rounded-full opacity-0 group-hover/social:opacity-100 blur-sm transition-all duration-300"></div>
                  <div class="relative bg-zinc-800/80 p-3 rounded-full hover:bg-zinc-800 transition-colors duration-300 transform group-hover/social:scale-110 text-white">
                    <Instagram class="w-5 h-5" />
                  </div>
                </a>
                <a href="#" class="group/social relative">
                  <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-500/70 to-cyan-500/70 rounded-full opacity-0 group-hover/social:opacity-100 blur-sm transition-all duration-300"></div>
                  <div class="relative bg-zinc-800/80 p-3 rounded-full hover:bg-zinc-800 transition-colors duration-300 transform group-hover/social:scale-110 text-white">
                    <Twitter class="w-5 h-5" />
                  </div>
                </a>
                <a href="#" class="group/social relative">
                  <div class="absolute -inset-0.5 bg-gradient-to-r from-blue-600/70 to-blue-400/70 rounded-full opacity-0 group-hover/social:opacity-100 blur-sm transition-all duration-300"></div>
                  <div class="relative bg-zinc-800/80 p-3 rounded-full hover:bg-zinc-800 transition-colors duration-300 transform group-hover/social:scale-110 text-white">
                    <Linkedin class="w-5 h-5" />
                  </div>
                </a>
                <a href="#" class="group/social relative">
                  <div class="absolute -inset-0.5 bg-gradient-to-r from-purple-600/70 to-violet-500/70 rounded-full opacity-0 group-hover/social:opacity-100 blur-sm transition-all duration-300"></div>
                  <div class="relative bg-zinc-800/80 p-3 rounded-full hover:bg-zinc-800 transition-colors duration-300 transform group-hover/social:scale-110 text-white">
                    <Github class="w-5 h-5" />
                  </div>
                </a>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
</section>

<!-- Cargar SweetAlert2 de manera más robusta -->
<script is:inline>
  // Función para cargar SweetAlert2 desde CDN
  function loadSweetAlert2() {
    return new Promise((resolve, reject) => {
      // Verificar si SweetAlert2 ya está cargado
      if (window.Swal) {
        resolve(window.Swal);
        return;
      }
      
      // Crear elemento script
      const script = document.createElement('script');
      script.src = 'https://cdn.jsdelivr.net/npm/sweetalert2@11';
      script.async = true;
      script.onload = () => resolve(window.Swal);
      script.onerror = () => reject(new Error('No se pudo cargar SweetAlert2'));
      
      // Añadir script al documento
      document.head.appendChild(script);
    });
  }
  
  // Cargar SweetAlert2 inmediatamente
  loadSweetAlert2().catch(error => {
    console.error('Error al cargar SweetAlert2:', error);
  });
</script>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const form = document.getElementById('contact-form') as HTMLFormElement;
    const result = document.getElementById('result') as HTMLDivElement;
    
    if (!form) return;
    
    form.addEventListener('submit', async function(e) {
      e.preventDefault();
      
      // Intentar cargar SweetAlert2 si aún no está disponible
      let Swal;
      try {
        // Usar la función global definida en el script anterior
        Swal = await (window as any).loadSweetAlert2();
      } catch (error) {
        console.error('No se pudo cargar SweetAlert2:', error);
        // Fallback a alertas normales si SweetAlert2 no está disponible
        alert('Enviando mensaje...');
      }
      
      const formData = new FormData(form);
      const object = Object.fromEntries(formData);
      const json = JSON.stringify(object);
      
      // Mostrar loading (con SweetAlert2 si está disponible, o con el elemento result si no)
      if (Swal) {
        Swal.fire({
          title: 'Enviando mensaje...',
          text: 'Por favor espera un momento',
          icon: 'info',
          allowOutsideClick: false,
          allowEscapeKey: false,
          showConfirmButton: false,
          didOpen: () => {
            Swal.showLoading();
          },
          background: '#18181b', // Fondo oscuro para combinar con el tema
          color: '#ffffff' // Texto blanco
        });
      } else {
        result.innerHTML = "Enviando mensaje...";
        result.classList.remove('hidden', 'text-green-500', 'text-red-500');
        result.classList.add('text-gray-400');
      }
      
      try {
        const response = await fetch('https://api.web3forms.com/submit', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
            'Accept': 'application/json'
          },
          body: json
        });
        
        const responseData = await response.json();
        
        if (response.status === 200) {
          // Éxito
          if (Swal) {
            Swal.fire({
              title: '¡Mensaje enviado!',
              text: 'Gracias por contactarnos. Te responderemos a la brevedad.',
              icon: 'success',
              confirmButtonText: 'Genial',
              confirmButtonColor: '#8b5cf6', // Color púrpura para combinar con el tema
              background: '#18181b', // Fondo oscuro
              color: '#ffffff' // Texto blanco
            });
          } else {
            result.innerHTML = "¡Mensaje enviado! Gracias por contactarnos.";
            result.classList.remove('hidden', 'text-gray-400', 'text-red-500');
            result.classList.add('text-green-500');
            setTimeout(() => {
              result.classList.add('hidden');
            }, 5000);
          }
          form.reset();
        } else {
          // Error
          if (Swal) {
            Swal.fire({
              title: 'Error',
              text: responseData.message || 'Ocurrió un error al enviar el mensaje. Por favor intenta nuevamente.',
              icon: 'error',
              confirmButtonText: 'Entendido',
              confirmButtonColor: '#8b5cf6', // Color púrpura para combinar con el tema
              background: '#18181b', // Fondo oscuro
              color: '#ffffff' // Texto blanco
            });
          } else {
            result.innerHTML = responseData.message || "Error al enviar el mensaje. Por favor intenta nuevamente.";
            result.classList.remove('hidden', 'text-gray-400', 'text-green-500');
            result.classList.add('text-red-500');
            setTimeout(() => {
              result.classList.add('hidden');
            }, 5000);
          }
        }
      } catch (error) {
        console.error('Error:', error);
        // Error de conexión
        if (Swal) {
          Swal.fire({
            title: 'Error de conexión',
            text: 'No pudimos conectar con el servidor. Por favor verifica tu conexión a internet e intenta nuevamente.',
            icon: 'error',
            confirmButtonText: 'Entendido',
            confirmButtonColor: '#8b5cf6', // Color púrpura para combinar con el tema
            background: '#18181b', // Fondo oscuro
            color: '#ffffff' // Texto blanco
          });
        } else {
          result.innerHTML = "Error de conexión. Por favor verifica tu internet e intenta nuevamente.";
          result.classList.remove('hidden', 'text-gray-400', 'text-green-500');
          result.classList.add('text-red-500');
          setTimeout(() => {
            result.classList.add('hidden');
          }, 5000);
        }
      }
    });
  });
</script>

<style>
  /* Animación para los campos del formulario */
  input, textarea {
    transition: all 0.3s ease;
  }
  
  input:focus, textarea:focus {
    transform: translateY(-2px);
    box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.15);
  }
  
  /* Animación para el botón */
  button[type="submit"] {
    transition: transform 0.3s ease, box-shadow 0.3s ease;
  }
  
  button[type="submit"]:hover {
    transform: translateY(-2px);
  }
  
  /* Estilos para mensajes de resultado */
  #result {
    padding: 0.75rem;
    border-radius: 0.5rem;
    transition: all 0.3s ease;
  }
  
  #result.text-green-500 {
    background-color: rgba(16, 185, 129, 0.1);
  }
  
  #result.text-red-500 {
    background-color: rgba(239, 68, 68, 0.1);
  }
  
  /* Animación para los elementos al hacer hover */
  @keyframes pulse-glow {
    0% { opacity: 0.4; }
    50% { opacity: 0.8; }
    100% { opacity: 0.4; }
  }
  
  .group:hover .animate-pulse-glow {
    animation: pulse-glow 2s infinite;
  }
</style>
